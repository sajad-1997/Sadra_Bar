{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ø§Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ - Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø­ÙˆØ± Ø¨Ø§ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

    <!-- Persian Datepicker CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css"/>

    <style>
        body { font-family: "Vazirmatn", Tahoma, sans-serif; background-color: #f0f2f5; padding: 10px; }
        h2 { text-align: center; color: #0d6efd; font-weight: 700; margin-bottom: 20px; }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ */
        .top-buttons { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .top-buttons a { flex: 1 1 150px; }

        /* ÙØ±Ù… ÙÛŒÙ„ØªØ± */
        .filter-card { margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 15px; background: #fff; }
        .filter-card input, .filter-card button, .filter-card a { border-radius: 8px; padding: 10px; font-size: 0.95rem; border: 1px solid #ced4da; }
        .filter-card input:focus { border-color: #0d6efd; box-shadow: 0 0 5px rgba(13,110,253,0.3); outline: none; }
        .filter-card button { background-color: #0d6efd; color: #fff; border: none; }
        .filter-card a { text-decoration: none; display: inline-block; text-align: center; }

        /* Ú©Ø§Ø±Øª Ø¨Ø§Ø±Ù†Ø§Ù…Ù‡ */
        .bijak-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            padding: 15px;
        }
        .bijak-header { font-weight: 700; margin-bottom: 10px; color: #0d6efd; font-size: 1.1rem; }
        .bijak-row { display: flex; justify-content: space-between; flex-wrap: wrap; margin-bottom: 6px; }
        .bijak-row span { flex: 1 1 45%; margin-bottom: 4px; }
        .btn-group-card { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }

        /* Ø¯Ø³Ú©ØªØ§Ù¾ Ø¬Ø¯ÙˆÙ„ */
        @media (min-width: 992px) {
            .bijak-card { display: none; }
            .desktop-table { display: table; width: 100%; border-collapse: collapse; }
            .desktop-table thead { background-color: #0d6efd; color: #fff; }
            .desktop-table th, .desktop-table td { padding: 8px; text-align: center; border: 1px solid #dee2e6; }
            .desktop-table tbody tr:hover { background-color: rgba(13,110,253,.05); }
        }
        @media (max-width: 991px) {
            .desktop-table { display: none; }
        }

        /* ÙÛŒÙ„Ø¯ ØªØ§Ø±ÛŒØ® */
        .datepicker-input {
            border-radius: 8px;
            padding: 10px;
            font-size: 0.95rem;
            border: 1px solid #ced4da;
            width: 100%;
        }
        .datepicker-input:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 5px rgba(13,110,253,0.3);
            outline: none;
        }
    </style>
</head>
<body>

<h2>ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ø§Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§</h2>

<!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ùˆ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
<div class="top-buttons">
    <a href="{% url 'home' %}" class="btn btn-outline-primary">ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
    <a href="{% url 'go_dashboard' %}" class="btn btn-outline-secondary">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
</div>

<!-- ÙØ±Ù… ÙÛŒÙ„ØªØ± -->
<div class="card filter-card shadow-sm">
    <form method="get">
        <div class="row g-2">
            <div class="col-12 col-md-3"><input type="text" name="tracking" value="{{ filters.tracking }}" class="form-control" placeholder="Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ"></div>
            <div class="col-12 col-md-3"><input type="text" name="sender" value="{{ filters.sender }}" class="form-control" placeholder="Ù†Ø§Ù… ÙØ±Ø³ØªÙ†Ø¯Ù‡"></div>
            <div class="col-12 col-md-3"><input type="text" name="receiver" value="{{ filters.receiver }}" class="form-control" placeholder="Ù†Ø§Ù… Ú¯ÛŒØ±Ù†Ø¯Ù‡"></div>
            <div class="col-12 col-md-3"><input type="text" name="origin" value="{{ filters.origin }}" class="form-control" placeholder="Ù…Ø¨Ø¯Ø§"></div>
        </div>
        <div class="row g-2 mt-2">
            <div class="col-12 col-md-3"><input type="text" name="destination" value="{{ filters.destination }}" class="form-control" placeholder="Ù…Ù‚ØµØ¯"></div>
            <div class="col-12 col-md-3"><input type="text" name="driver" value="{{ filters.driver }}" class="form-control" placeholder="Ù†Ø§Ù… Ø±Ø§Ù†Ù†Ø¯Ù‡"></div>
            <div class="col-12 col-md-3"><input type="text" id="start_date" class="datepicker-input" placeholder="ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹"></div>
            <div class="col-12 col-md-3"><input type="text" id="end_date" class="datepicker-input" placeholder="ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†"></div>
        </div>
        <div class="row g-2 mt-2">
            <div class="col-6 col-md-3"><button type="submit" class="btn w-100">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±</button></div>
            <div class="col-6 col-md-3"><a href="{% url 'search_shipment' %}" class="btn btn-outline-secondary w-100">Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙÛŒÙ„ØªØ±</a></div>
        </div>

        <!-- ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ -->
        <input type="hidden" name="start_date" id="start_date_alt">
        <input type="hidden" name="end_date" id="end_date_alt">
    </form>
</div>

<!-- Ú©Ø§Ø±Øª Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
{% for b in bijaks %}
<div class="bijak-card">
    <div class="bijak-header">Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ: {{ b.tracking_code }} | ØªØ§Ø±ÛŒØ® ØµØ¯ÙˆØ±: {{ b.issuance_date }}</div>
    <div class="bijak-row"><span>ÙØ±Ø³ØªÙ†Ø¯Ù‡: {{ b.sender.name }}</span><span>Ú¯ÛŒØ±Ù†Ø¯Ù‡: {{ b.receiver.name }}</span></div>
    <div class="bijak-row"><span>Ú©Ù„ Ú©Ø±Ø§ÛŒÙ‡: {{ b.total_fare|intcomma }} Ø±ÛŒØ§Ù„</span><span>Ø§Ø±Ø²Ø´ Ù…Ø­Ù…ÙˆÙ„Ù‡: {{ b.value|intcomma }} Ø±ÛŒØ§Ù„</span></div>
    <div class="bijak-row"><span>Ù†Ø§Ù… Ù…Ø­Ù…ÙˆÙ„Ù‡: {{ b.cargo.name }}</span><span>Ù…Ø¨Ø¯Ø§: {{ b.cargo.origin }}</span></div>
    <div class="bijak-row"><span>Ù…Ù‚ØµØ¯: {{ b.cargo.destination }}</span><span>Ø±Ø§Ù†Ù†Ø¯Ù‡: {{ b.driver.name }}</span></div>
    <div class="btn-group-card">
        <a href="{% url 'print' b.pk %}" class="btn btn-sm btn-primary w-100">Ú†Ø§Ù¾</a>
        <a href="{% url 'preview' b.pk %}" class="btn btn-sm btn-info w-100">Ù…Ø´Ø§Ù‡Ø¯Ù‡</a>
        <a href="{% url 'edit_bijak' b.pk %}" class="btn btn-sm btn-warning w-100">ÙˆÛŒØ±Ø§ÛŒØ´</a>
        <a href="{% url 'delete_bijak' b.pk %}" class="btn btn-sm btn-danger w-100">Ø­Ø°Ù</a>
    </div>
</div>
{% empty %}
<p class="text-center mt-3">Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
{% endfor %}

<!-- Ø¬Ø¯ÙˆÙ„ Ø¯Ø³Ú©ØªØ§Ù¾ -->
<table class="desktop-table">
    <thead>
        <tr>
            <th>Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ</th>
            <th>ØªØ§Ø±ÛŒØ® ØµØ¯ÙˆØ±</th>
            <th>ÙØ±Ø³ØªÙ†Ø¯Ù‡</th>
            <th>Ú¯ÛŒØ±Ù†Ø¯Ù‡</th>
            <th>Ú©Ù„ Ú©Ø±Ø§ÛŒÙ‡</th>
            <th>Ø§Ø±Ø²Ø´ Ù…Ø­Ù…ÙˆÙ„Ù‡</th>
            <th>Ù†Ø§Ù… Ù…Ø­Ù…ÙˆÙ„Ù‡</th>
            <th>Ù…Ø¨Ø¯Ø§</th>
            <th>Ù…Ù‚ØµØ¯</th>
            <th>Ø±Ø§Ù†Ù†Ø¯Ù‡</th>
            <th>Ù¾Ù„Ø§Ú© Ø®ÙˆØ¯Ø±Ùˆ</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
    </thead>
    <tbody>
        {% for b in bijaks %}
        <tr>
            <td>{{ b.tracking_code }}</td>
            <td>{{ b.issuance_date }}</td>
            <td>{{ b.sender.name }}</td>
            <td>{{ b.receiver.name }}</td>
            <td>{{ b.total_fare|intcomma }} Ø±ÛŒØ§Ù„</td>
            <td>{{ b.value|intcomma }} Ø±ÛŒØ§Ù„</td>
            <td>{{ b.cargo.name }}</td>
            <td>{{ b.cargo.origin }}</td>
            <td>{{ b.cargo.destination }}</td>
            <td>{{ b.driver.name }}</td>
            <td>{{ b.vehicle.license_plate_two_digit }} {{ b.vehicle.license_plate_alphabet }} {{ b.vehicle.license_plate_three_digit }} || Ø§ÛŒØ±Ø§Ù† {{ b.vehicle.license_plate_series }}</td>
            <td>
                <a href="{% url 'print' b.pk %}" class="btn btn-sm btn-primary">Ú†Ø§Ù¾</a>
                <a href="{% url 'preview' b.pk %}" class="btn btn-sm btn-info">Ù…Ø´Ø§Ù‡Ø¯Ù‡</a>
                <a href="{% url 'edit_bijak' b.pk %}" class="btn btn-sm btn-warning">ÙˆÛŒØ±Ø§ÛŒØ´</a>
                <a href="{% url 'delete_bijak' b.pk %}" class="btn btn-sm btn-danger">Ø­Ø°Ù</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- JQuery Ùˆ Persian Datepicker JS -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>

<script>
$(document).ready(function(){

    $("#start_date").persianDatepicker({
        format: 'YYYY-MM-DD',
        autoClose: true,
        calendarType: 'persian',
        altField: '#start_date_alt',
        altFormat: 'YYYY-MM-DD',
        onSelect: function(unix){
            var pd = new persianDate(unix);
            $('#start_date_alt').val(pd.toCalendar('gregorian').format('YYYY-MM-DD'));
        }
    });

    $("#end_date").persianDatepicker({
        format: 'YYYY-MM-DD',
        autoClose: true,
        calendarType: 'persian',
        altField: '#end_date_alt',
        altFormat: 'YYYY-MM-DD',
        onSelect: function(unix){
            var pd = new persianDate(unix);
            $('#end_date_alt').val(pd.toCalendar('gregorian').format('YYYY-MM-DD'));
        }
    });

});
</script>

</body>
</html>
