{% load static %}
<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {font-family: Vazirmatn, sans-serif; direction: rtl; margin: 20px;}
        table {width: 100%; border-collapse: collapse; margin-top: 15px;}
        th, td {border: 1px solid #ccc; padding: 8px; text-align: center;}
        th {background-color: #eee;}
        .summary {margin-top: 10px; font-weight: bold;}
        .stats-box {display: flex; gap: 10px; margin: 15px 0;}
        .card {flex: 1; background: #f8f8f8; padding: 10px; border-radius: 8px; text-align: center;}
    </style>
</head>
<body>

<h2>ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØµØ§Ø¯Ø± Ø´Ø¯Ù‡</h2>

<form method="get">
  {{ form.as_p }}
  <button type="submit">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±</button>
</form>

<div class="stats-box">
    <div class="card">Ø§Ù…Ø±ÙˆØ²: {{ stats.daily }}</div>
    <div class="card">Ø§ÛŒÙ† Ù‡ÙØªÙ‡: {{ stats.weekly }}</div>
    <div class="card">Ø§ÛŒÙ† Ù…Ø§Ù‡: {{ stats.monthly }}</div>
    <div class="card">Ø§Ù…Ø³Ø§Ù„: {{ stats.yearly }}</div>
</div>

<div class="summary">
    ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: {{ total_count }} | Ù…Ø¬Ù…ÙˆØ¹ Ú©Ø±Ø§ÛŒÙ‡: {{ total_fare }}
</div>

<canvas id="chart" width="400" height="150"></canvas>

<table>
    <thead>
        <tr>
            <th>Ø´Ù…Ø§Ø±Ù‡</th>
            <th>Ø±Ø§Ù†Ù†Ø¯Ù‡</th>
            <th>Ù…Ø¨Ø¯Ø£</th>
            <th>Ù…Ù‚ØµØ¯</th>
            <th>ØªØ§Ø±ÛŒØ® ØµØ¯ÙˆØ±</th>
            <th>Ú©Ø±Ø§ÛŒÙ‡</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
        </tr>
    </thead>
    <tbody>
        {% for b in reports %}
        <tr>
            <td>{{ b.number }}</td>
            <td>{{ b.driver.name }}</td>
            <td>{{ b.origin }}</td>
            <td>{{ b.destination }}</td>
            <td>{{ b.date_issued }}</td>
            <td>{{ b.fare }}</td>
            <td>{{ b.get_status_display }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="7">Ù‡ÛŒÚ† Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>
        {% endfor %}
    </tbody>
</table>

<script>
const ctx = document.getElementById('chart').getContext('2d');
const chartData = {
    labels: {{ daily_data|safe|json_script:"labels" }},
    datasets: [{
        label: 'ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡',
        data: {{ daily_data|json_script:"values" }},
    }]
};
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ daily_data|map(attribute='date')|list|safe }},
        datasets: [{
            label: 'ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø±Ù†Ø§Ù…Ù‡',
            data: {{ daily_data|map(attribute='count')|list|safe }},
            borderWidth: 1
        }]
    },
});
</script>

</body>
</html>
